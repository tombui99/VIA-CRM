<h2 [class]="hlmH2">Leads</h2>
@if(leadsQuery.error()) {
<div class="flex h-8 w-full items-center">
  <div class="text-destructive text-sm">Error loading leads: {{ leadsQuery.error()?.message }}</div>
</div>
}

<!-- Mutation errors -->
@if(createLeadMutation.error() || updateLeadMutation.error()) {
<div class="flex h-8 w-full items-center">
  <div class="text-destructive text-sm">Error creating/updating leads</div>
</div>
}

<!-- Content -->
@if (leadsQuery.isLoading()) {
<div class="flex h-48 w-full items-center justify-center">
  <div class="text-muted-foreground text-sm">Loading...</div>
</div>
} @else if(hasResults()) {
<div class="mb-4 mt-4 flex items-center">
  <hlm-tabs tab="account" class="w-full">
    <hlm-tabs-list aria-label="tabs example">
      <button hlmTabsTrigger="account">Add new lead</button>
      <button hlmTabsTrigger="password">Import CSV</button>
    </hlm-tabs-list>
    <div hlmTabsContent="account">
      <section hlmCard>
        <div hlmCardHeader>
          <h3 hlmCardTitle>Add a new lead</h3>
          <p hlmCardDescription>Add a new lead here through form submission.</p>
        </div>
        <div hlmCardFooter>
          <button hlmBtn (click)="openLeadFormSheet()">Add new lead</button>
        </div>
      </section>
    </div>
    <div hlmTabsContent="password">
      <section hlmCard>
        <div hlmCardHeader>
          <h3 hlmCardTitle>Import Leads through CSV</h3>
          <p hlmCardDescription>
            Add new leads by importing CSV files. Ensure the file meets the correct format.
          </p>
        </div>
        <!-- CSV Picker -->
        <div hlmCardContent class="grid w-full max-w-sm items-center gap-3">
          <input hlmInput id="csv" accept=".csv" (change)="onFileSelected($event)" type="file" />
        </div>

        <!-- Selected file info -->
        @if(selectedFile) {
        <div class="rounded-md border p-3 m-4 text-sm">
          <div class="font-medium">
            {{ selectedFile.name }}
          </div>
          <div class="text-muted-foreground">
            {{ selectedFile.size / 1024 | number : '1.0-0' }} KB
          </div>
        </div>
        }
        <div hlmCardFooter>
          <button hlmBtn [disabled]="!selectedFile" (click)="importCsv()">Upload & Import</button>
        </div>
      </section>
    </div>
  </hlm-tabs>

  <lead-sheet
    #leadSheetForm
    [lead]="selectedLead()"
    (submit)="handleLeadSubmit($event)"
  ></lead-sheet>
</div>
<custom-datatable
  [data]="leadsQuery.data()"
  [columns]="columns()"
  [options]="{ enableResizing: true, minSize: 60, maxSize: 800, tableId: 'leads-table' }"
  [currentSort]="currentSort()"
  (sortChange)="onSortChange($event)"
>
</custom-datatable>
<ng-template #firstNameCell let-context>
  <span
    class="underline capitalize cursor-pointer"
    role="button"
    tabindex="0"
    (click)="openLeadFormSheet(context.row.original)"
    >{{ context.getValue() }}</span
  >
</ng-template>
<ng-template #priorityCell let-context>
  <!-- TODO: This logic can be cleaned up -->
  <span
    class="capitalize"
    [class]="{
      'text-destructive': context.getValue() === 1,
      'text-orange-400': context.getValue() === 2,
      'text-green-500': context.getValue() === 3,
      'text-gray-500': context.getValue() === 4
    }"
    >{{ mapPriority(context.getValue()) }}</span
  >
</ng-template>
}
